services:
  api:
    image: myspinbot/backend:dev
    build:
      args:
        NODE_ENV: development
    ports:
      - "9229:9229"
    entrypoint: ["/bin/sh", "-l"]
    stdin_open: true
    tty: true
    volumes:
      - ./docs:/app/docs
      - ./common/shared:/app/shared
      - ./backend/.vscode:/app/.vscode
      - ./backend/src:/app/src
      - ./backend/tests:/app/tests
      - ./backend/package-lock.json:/app/package-lock.json
      - ./backend/package.json:/app/package.json
      - ./backend/vitest.config.ts:/app/vitest.config.ts
      - ./backend/config:/app/config
      - ./backend/AGENT.md:/app/AGENT.md
      - ./common/config/schemas:/app/config/schemas
      - ./common/config/redis.bridge.json:/app/config/redis.bridge.json

  ui:
    image: myspinbot/frontend:dev
    build:
      target: development
      args:
        NODE_ENV: development
    ports:
      - "9230:9230"
    volumes:
      - ./docs:/app/docs
      - ./common/shared:/app/shared
      - ./frontend/.vscode:/app/.vscode
      - ./frontend/.gemini:/app/.gemini
      - ./frontend/app:/app/app
      - ./frontend/components:/app/components
      - ./frontend/lib:/app/lib
      - ./frontend/public:/app/public
      - ./frontend/tests:/app/tests
      - ./frontend/next-env.d.ts:/app/next-env.d.ts
      - ./frontend/next.config.mjs:/app/next.config.mjs
      - ./frontend/package.json:/app/package.json
      - ./frontend/package-lock.json:/app/package-lock.json
      - ./frontend/postcss.config.js:/app/postcss.config.js
      - ./frontend/tailwind.config.ts:/app/tailwind.config.ts
      - ./frontend/tsconfig.json:/app/tsconfig.json
      - ./frontend/vitest.config.ts:/app/vitest.config.ts
      - ./frontend/AGENT.md:/app/AGENT.md

  worker:
    image: myspinbot/worker:dev
    build:
      args:
        WORKER_ENVIRONMENT: development
    ports:
      - "5678:5678"
    entrypoint: ["/bin/bash", "-l"]
    stdin_open: true
    tty: true
    volumes:
      - ./docs:/opt/app/docs
      - ./common/shared:/opt/app/shared
      - ./worker/.vscode:/opt/app/.vscode
      - ./worker/src:/opt/app/src
      - ./worker/pyproject.toml:/opt/app/pyproject.toml
      - ./worker/AGENT.md:/opt/app/AGENT.md
      - ./worker/config:/opt/app/config
      - ./common/config/schemas:/opt/app/config/schemas
      - ./common/config/redis.bridge.json:/opt/app/config/redis.bridge.json

  comfyui:
    image: myspinbot/comfyui:dev
    build:
      args:
        WORKER_ENVIRONMENT: development
    ports:
      - "5679:5678"
    entrypoint: ["/bin/bash", "-l"]
    stdin_open: true
    tty: true
    volumes:
      - ./infra/worker/.vscode:/opt/comfyui/.vscode
    profiles: ["ai"]

  sandbox:
    image: myspinbot/sandbox:dev
    build:
      context: .
      dockerfile: infra/sandbox/Dockerfile
    container_name: myspinbot-sandbox
    entrypoint: ["bash", "-l"]
    stdin_open: true
    tty: true
    volumes:
      - .:/workspace
    profiles: ["monorepo"]

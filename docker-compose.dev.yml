services:
  api:
    image: myspinbot/backend:dev
    build:
      args:
        NODE_ENV: development
    ports:
      - "9229:9229"
    entrypoint: ["/bin/sh", "-l"]
    stdin_open: true
    tty: true
    volumes:
      - ./backend:/home/dev
      - ./docs:/home/dev/docs
      - ./common/shared:/home/dev/shared
      - ./common/config/schemas:/home/dev/config/schemas
      - ./common/config/redis.bridge.json:/home/dev/config/redis.bridge.json
      - /home/dev/node_modules
      - ./backend/.devcontainer:/home/dev/.devcontainer:ro
      - ./backend/Dockerfile:/home/dev/Dockerfile:ro
      - ./backend/docker-entrypoint.sh:/home/dev/docker-entrypoint.sh:ro
    working_dir: /home/dev

  ui:
    image: myspinbot/frontend:dev
    build:
      target: development
      args:
        NODE_ENV: development
    ports:
      - "9230:9230"
    volumes:
      - ./docs:/app/docs
      - ./common/shared:/app/shared
      - ./frontend/.vscode:/app/.vscode
      - ./frontend/.gemini:/app/.gemini
      - ./frontend/app:/app/app
      - ./frontend/components:/app/components
      - ./frontend/lib:/app/lib
      - ./frontend/public:/app/public
      - ./frontend/tests:/app/tests
      - ./frontend/next-env.d.ts:/app/next-env.d.ts
      - ./frontend/next.config.mjs:/app/next.config.mjs
      - ./frontend/package.json:/app/package.json
      - ./frontend/package-lock.json:/app/package-lock.json
      - ./frontend/postcss.config.js:/app/postcss.config.js
      - ./frontend/tailwind.config.ts:/app/tailwind.config.ts
      - ./frontend/tsconfig.json:/app/tsconfig.json
      - ./frontend/vitest.config.ts:/app/vitest.config.ts
      - ./frontend/AGENT.md:/app/AGENT.md

  worker:
    image: myspinbot/worker:dev
    build:
      args:
        WORKER_ENVIRONMENT: development
    ports:
      - "5678:5678"
    stdin_open: true
    tty: true
    environment:
      - WORKER_HOME=/home/dev
    volumes:
      - ./worker:/home/dev
      - ./docs:/home/dev/docs
      - ./common/shared:/home/dev/shared
      - ./common/config/schemas:/home/dev/config/schemas
      - ./common/config/redis.bridge.json:/home/dev/config/redis.bridge.json
      - ./worker/.devcontainer:/home/dev/.devcontainer:ro
      - ./worker/docker-entrypoint.sh:/home/dev/docker-entrypoint.sh:ro
    working_dir: /home/dev

  comfyui:
    image: myspinbot/comfyui:dev
    build:
      args:
        WORKER_ENVIRONMENT: development
    ports:
      - "5679:5678"
    entrypoint: ["/bin/bash", "-l"]
    stdin_open: true
    tty: true
    volumes:
      - ./infra/worker/.vscode:/opt/comfyui/.vscode
    profiles: ["ai"]

  sandbox:
    image: myspinbot/sandbox:dev
    build:
      context: .
      dockerfile: infra/sandbox/Dockerfile
    container_name: myspinbot-sandbox
    entrypoint: ["bash", "-l"]
    stdin_open: true
    tty: true
    volumes:
      - .:/workspace
    profiles: ["monorepo"]

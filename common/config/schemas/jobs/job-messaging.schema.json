{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "job-messaging.schema.json",
  "title": "Job Messaging Schemas",
  "type": "object",
  "$defs": {
    "JobMessage": {
      "type": "object",
      "title": "JobMessage",
      "description": "Raw message pulled directly from Redis Streams (before normalization).",
      "properties": {
        "xid": {
          "type": "string",
          "description": "Redis Stream entry ID"
        },
        "stream": {
          "type": "string",
          "description": "Stream name"
        },
        "jobId": {
          "type": "string",
          "description": "Unique job ID"
        },
        "created": {
          "type": [
            "string",
            "null"
          ],
          "description": "Timestamp in ms (stringified)"
        },
        "graph": {
          "type": [
            "string",
            "null"
          ],
          "description": "Serialized execution graph (langgraph v1)"
        }
      },
      "required": [
        "xid",
        "stream",
        "jobId",
        "created",
        "graph"
      ],
      "additionalProperties": false
    },
    "JobStatus": {
      "type": "string",
      "title": "JobStatus",
      "description": "Allowed job lifecycle states.",
      "enum": [
        "advertised",
        "queued",
        "running",
        "completed",
        "failed"
      ]
    },
    "DataUpdate": {
      "type": "object",
      "title": "DataUpdate",
      "description": "Pub/Sub payload containing generic job updates.",
      "properties": {
        "jobId": {
          "type": "string"
        },
        "data": {
          "type": "string"
        },
        "created": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "jobId",
        "data",
        "created"
      ],
      "additionalProperties": false
    },
    "ProgressUpdate": {
      "type": "object",
      "title": "ProgressUpdate",
      "description": "Payload for job progress updates.",
      "properties": {
        "jobId": {
          "type": "string"
        },
        "progress": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Normalized progress value between 0 and 1 inclusive"
        },
        "created": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "jobId",
        "progress",
        "created"
      ],
      "additionalProperties": false
    },
    "StatusUpdate": {
      "type": "object",
      "title": "StatusUpdate",
      "description": "Payload for job status updates.",
      "properties": {
        "jobId": {
          "type": "string"
        },
        "status": {
          "$ref": "#/$defs/JobStatus"
        },
        "created": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "jobId",
        "status",
        "created"
      ],
      "additionalProperties": false
    },
    "StateUpdate": {
      "type": "object",
      "title": "StateUpdate",
      "description": "Payload for job state updates.",
      "properties": {
        "jobId": {
          "type": "string"
        },
        "status": {
          "$ref": "#/$defs/JobStatus"
        },
        "progress": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Normalized progress value between 0 and 1 inclusive"
        }
      },
      "required": [
        "jobId",
        "status",
        "progress"
      ],
      "additionalProperties": false
    }
  }
}